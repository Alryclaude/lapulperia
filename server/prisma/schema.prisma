generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch"]  // Enables PostgreSQL full-text search via Prisma queries
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  CLIENT
  PULPERIA
}

enum OrderStatus {
  PENDING
  ACCEPTED
  PREPARING
  READY
  DELIVERED
  CANCELLED
}

enum JobApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum PulperiaStatus {
  OPEN
  CLOSING_SOON
  CLOSED
  VACATION
}

enum PulperiaCategory {
  COMER       // Restaurantes, baleadas, comida
  COMPRAR     // Abarrotes, mercados, tiendas
  SERVICIOS   // Talleres, recargas, pagos
}

enum PromotionType {
  PERCENTAGE
  FIXED_AMOUNT
  BUY_X_GET_Y
  COMBO
}

enum PriceType {
  FIXED
  HOURLY
  NEGOTIABLE
}

// Usuarios
model User {
  id                  String              @id @default(cuid())
  email               String              @unique
  name                String
  avatar              String?
  phone               String?
  role                Role                @default(CLIENT)
  firebaseUid         String              @unique
  fcmToken            String?             // Firebase Cloud Messaging token para push notifications
  fcmTokenUpdatedAt   DateTime?           // Cuándo se actualizó el token FCM
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt

  pulperia            Pulperia?
  orders              Order[]
  reviews             Review[]
  jobApplications     JobApplication[]
  serviceCatalogs     ServiceCatalog[]
  pushSubscriptions   PushSubscription[]
  favorites           Favorite[]
  shoppingLists       ShoppingList[]
  productAlerts       ProductAlert[]
  productFavorites    ProductFavorite[]
  fiadoAccounts       FiadoAccount[]
  chambas             Chamba[]
  chambaResponses     ChambaResponse[]
  appointments        Appointment[]
  quotes              Quote[]

  @@index([email])
  @@index([firebaseUid])
}

// Pulperias (Negocios)
model Pulperia {
  id                  String          @id @default(cuid())
  userId              String          @unique
  name                String
  description         String?
  logo                String?
  logoPublicId        String?
  banner              String?
  bannerPublicId      String?
  phone               String?
  whatsapp            String?

  // Ubicacion (nullable para negocios online-only)
  latitude            Float?
  longitude           Float?
  address             String?
  reference           String?         // "Frente al palo de mango"

  // Estado
  status              PulperiaStatus  @default(CLOSED)
  statusChangedAt     DateTime        @default(now())
  vacationMessage     String?
  vacationUntil       DateTime?

  // Historia del negocio
  foundedYear         Int?
  story               String?
  storyImages         String[]

  // Estadisticas
  totalSales          Int             @default(0)
  totalOrders         Int             @default(0)
  rating              Float           @default(0)
  reviewCount         Int             @default(0)

  // Configuracion
  acceptsDelivery     Boolean         @default(false)
  acceptsPickup       Boolean         @default(true)

  isVerified          Boolean         @default(false)
  isPermanentlyClosed Boolean         @default(false)
  isOnlineOnly        Boolean         @default(false)
  originCity          String?         // Ciudad de origen para envios (negocios online)
  shippingScope       String          @default("LOCAL")  // LOCAL, NACIONAL, DIGITAL

  // Categorías del negocio (múltiples permitidas)
  categories          PulperiaCategory[]  @default([])

  // Tipo de negocio (para onboarding adaptativo)
  businessType        BusinessType    @default(TIENDA)

  // Ubicación en vivo (para ambulantes)
  isLocationLive      Boolean         @default(false)
  lastLocationAt      DateTime?
  locationNote        String?         // "Hoy en col. Kennedy"

  // Redes sociales
  socialLinks         Json?           // { facebook, instagram, tiktok, twitter, youtube, telegram }

  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  user                User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  products            Product[]
  orders              Order[]
  jobs                Job[]
  reviews             Review[]
  favorites           Favorite[]
  achievements        Achievement[]
  dailyStats          DailyStat[]
  businessHours       BusinessHours?
  promotions          Promotion[]
  services            PulperiaService[]
  shippingMethods     ShippingMethod[]
  paymentMethods      PaymentMethod[]
  fiadoAccounts       FiadoAccount[]
  chambas             Chamba[]
  appointments        Appointment[]
  quotes              Quote[]
  expenses            Expense[]
  announcements       Announcement[]

  @@index([latitude, longitude])
  @@index([status])
}

// Metodos de envio para negocios online
model ShippingMethod {
  id            String    @id @default(cuid())
  pulperiaId    String
  name          String    // "Hugo", "Cargo Expreso", "Pickup", "Digital"
  coverageArea  String?   // "Tegucigalpa", "Todo Honduras", "Internacional"
  estimatedDays String?   // "1-2 dias", "3-5 dias"
  baseCost      Float?    // Costo base en Lempiras
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())

  pulperia      Pulperia  @relation(fields: [pulperiaId], references: [id], onDelete: Cascade)

  @@index([pulperiaId])
}

// Metodos de pago configurados por pulpería
enum PaymentProvider {
  // Bancos Honduras
  BAC
  BANPAIS
  FICOHSA
  ATLANTIDA
  DAVIVIENDA
  OCCIDENTE
  BANRURAL
  LAFISE
  // Billeteras
  TIGO_MONEY
  TENGO
  // Otros
  CASH
  OTHER
}

model PaymentMethod {
  id              String          @id @default(cuid())
  pulperiaId      String
  provider        PaymentProvider
  accountName     String          // Nombre del titular
  accountNumber   String          // Número de cuenta/teléfono
  instructions    String?         // Instrucciones adicionales
  isActive        Boolean         @default(true)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  pulperia        Pulperia        @relation(fields: [pulperiaId], references: [id], onDelete: Cascade)

  @@index([pulperiaId])
}

// Sistema de Fiado
model FiadoAccount {
  id            String              @id @default(cuid())
  pulperiaId    String
  clientId      String
  creditLimit   Float               @default(0)   // Límite definido por pulpería
  currentBalance Float              @default(0)   // Deuda actual
  isBlocked     Boolean             @default(false)
  lastPaymentAt DateTime?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  pulperia      Pulperia            @relation(fields: [pulperiaId], references: [id], onDelete: Cascade)
  client        User                @relation(fields: [clientId], references: [id], onDelete: Cascade)
  transactions  FiadoTransaction[]

  @@unique([pulperiaId, clientId])
  @@index([pulperiaId])
  @@index([clientId])
}

enum FiadoType {
  CREDIT    // Se fió algo (agrega deuda)
  PAYMENT   // Abonó/pagó (reduce deuda)
}

model FiadoTransaction {
  id          String      @id @default(cuid())
  accountId   String
  type        FiadoType
  amount      Float
  orderId     String?     // Referencia al pedido (si es CREDIT)
  note        String?
  createdAt   DateTime    @default(now())

  account     FiadoAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  items       FiadoTransactionItem[]

  @@index([accountId])
  @@index([accountId, createdAt])  // Índice compuesto para transacciones por cuenta y fecha
}

// Items detallados de una transacción de fiado
model FiadoTransactionItem {
  id            String            @id @default(cuid())
  transactionId String
  productName   String            // Nombre del producto (snapshot)
  quantity      Int               @default(1)
  unitPrice     Float             // Precio unitario al momento

  transaction   FiadoTransaction  @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  @@index([transactionId])
}

// Productos
model Product {
  id                  String          @id @default(cuid())
  pulperiaId          String
  name                String
  description         String?
  price               Float
  category            String?
  imageUrl            String
  imagePublicId       String

  // Tipo de producto (inventario híbrido)
  type                ProductType     @default(PHYSICAL)
  priceUnit           String?         // "hora", "unidad", "lb", "kg"
  allowFraction       Boolean         @default(false)

  isAvailable         Boolean         @default(true)
  isFeatured          Boolean         @default(false)      // Producto del dia
  featuredUntil       DateTime?
  viewsToday          Int             @default(0)
  totalViews          Int             @default(0)

  // Stock management
  outOfStock          Boolean         @default(false)
  sellsQuickly        Boolean         @default(false)      // Badge automatico
  stockQuantity       Int?                                  // null = no se trackea
  lowStockAlert       Int?                                  // umbral de alerta
  sku                 String?                               // SKU opcional

  // Temporada
  isSeasonal          Boolean         @default(false)
  seasonalTag         String?                               // "Verano", "Navidad"

  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  pulperia            Pulperia        @relation(fields: [pulperiaId], references: [id], onDelete: Cascade)
  orderItems          OrderItem[]
  productAlerts       ProductAlert[]
  productFavorites    ProductFavorite[]

  @@index([pulperiaId])
  @@index([category])
  @@index([pulperiaId, category])  // Índice compuesto para filtrar productos por pulpería y categoría
  @@index([isAvailable, outOfStock])
  @@index([name])  // Index for text searches
}

// Ordenes
model Order {
  id                  String          @id @default(cuid())
  orderNumber         String          @unique
  userId              String
  pulperiaId          String
  status              OrderStatus     @default(PENDING)
  total               Float
  notes               String?                               // Notas del cliente

  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  acceptedAt          DateTime?
  readyAt             DateTime?
  deliveredAt         DateTime?
  cancelledAt         DateTime?
  cancelReason        String?
  isQuickSale         Boolean         @default(false)    // Venta rápida (sin productos)

  user                User            @relation(fields: [userId], references: [id])
  pulperia            Pulperia        @relation(fields: [pulperiaId], references: [id])
  items               OrderItem[]

  @@index([userId])
  @@index([pulperiaId])
  @@index([status])
  @@index([createdAt])
  @@index([pulperiaId, createdAt])  // Índice compuesto para órdenes por pulpería y fecha
  @@index([pulperiaId, status])     // Índice compuesto para órdenes por pulpería y estado
  @@index([isQuickSale])
}

model OrderItem {
  id                  String          @id @default(cuid())
  orderId             String
  productId           String?                               // Nullable para permitir eliminación de productos
  quantity            Int
  priceAtTime         Float
  productName         String                                // Snapshot del nombre
  productImage        String                                // Snapshot de la imagen

  order               Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product             Product?        @relation(fields: [productId], references: [id], onDelete: SetNull)

  @@index([orderId])
  @@index([productId])  // Para queries de ventas por producto
}

// Empleos
model Job {
  id                  String          @id @default(cuid())
  pulperiaId          String
  title               String
  description         String
  requirements        String?
  salary              String?
  isPartTime          Boolean         @default(false)
  isUrgent            Boolean         @default(false)
  isActive            Boolean         @default(true)

  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  pulperia            Pulperia        @relation(fields: [pulperiaId], references: [id], onDelete: Cascade)
  applications        JobApplication[]

  @@index([pulperiaId])
  @@index([isActive])
}

model JobApplication {
  id                  String                  @id @default(cuid())
  jobId               String
  userId              String
  coverLetter         String?
  cvUrl               String?
  cvPublicId          String?
  status              JobApplicationStatus    @default(PENDING)
  responseMessage     String?
  contactInfo         String?                               // Info de contacto si es aceptado

  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @updatedAt

  job                 Job                     @relation(fields: [jobId], references: [id], onDelete: Cascade)
  user                User                    @relation(fields: [userId], references: [id])

  @@unique([jobId, userId])
  @@index([userId])
}

// Catalogo de servicios (freelancers)
model ServiceCatalog {
  id                  String          @id @default(cuid())
  userId              String
  profession          String
  description         String?
  images              String[]
  imagePublicIds      String[]
  contactPhone        String?
  contactWhatsapp     String?

  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  user                User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([profession])
}

// Reviews
model Review {
  id                  String          @id @default(cuid())
  userId              String
  pulperiaId          String
  rating              Int                                   // 1-5
  comment             String?

  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  user                User            @relation(fields: [userId], references: [id])
  pulperia            Pulperia        @relation(fields: [pulperiaId], references: [id], onDelete: Cascade)

  @@unique([userId, pulperiaId])
  @@index([pulperiaId])
  @@index([userId])  // Para queries de reseñas por usuario
}

// Favoritos
model Favorite {
  id                  String          @id @default(cuid())
  userId              String
  pulperiaId          String
  notifyOnOpen        Boolean         @default(false)

  createdAt           DateTime        @default(now())

  user                User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  pulperia            Pulperia        @relation(fields: [pulperiaId], references: [id], onDelete: Cascade)

  @@unique([userId, pulperiaId])
}

// Lista de mandados
model ShoppingList {
  id                  String          @id @default(cuid())
  userId              String
  name                String
  items               String[]

  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  user                User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

// Alertas de productos (avisame cuando llegue)
model ProductAlert {
  id                  String          @id @default(cuid())
  userId              String
  productId           String
  notified            Boolean         @default(false)

  createdAt           DateTime        @default(now())

  user                User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  product             Product         @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
}

// Productos favoritos del cliente
model ProductFavorite {
  id                  String          @id @default(cuid())
  userId              String
  productId           String

  createdAt           DateTime        @default(now())

  user                User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  product             Product         @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([userId])
}

// Push subscriptions
model PushSubscription {
  id                  String          @id @default(cuid())
  userId              String
  endpoint            String
  p256dh              String
  auth                String

  createdAt           DateTime        @default(now())

  user                User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

// Logros
model Achievement {
  id                  String          @id @default(cuid())
  pulperiaId          String
  type                String                                // FIRST_SALE, STREAK_7, etc.
  unlockedAt          DateTime        @default(now())

  pulperia            Pulperia        @relation(fields: [pulperiaId], references: [id], onDelete: Cascade)

  @@unique([pulperiaId, type])
}


// Estadisticas diarias
model DailyStat {
  id                  String          @id @default(cuid())
  pulperiaId          String
  date                DateTime        @db.Date
  totalSales          Float           @default(0)
  totalOrders         Int             @default(0)
  topProducts         Json?                                 // Array de {productId, count}

  pulperia            Pulperia        @relation(fields: [pulperiaId], references: [id], onDelete: Cascade)

  @@unique([pulperiaId, date])
  @@index([date])
  @@index([pulperiaId, date])  // Índice compuesto para stats por pulpería y fecha
}

// Horarios de apertura
model BusinessHours {
  id                  String          @id @default(cuid())
  pulperiaId          String          @unique
  monday              Json?                                 // { open: "08:00", close: "18:00", closed: false }
  tuesday             Json?
  wednesday           Json?
  thursday            Json?
  friday              Json?
  saturday            Json?
  sunday              Json?

  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  pulperia            Pulperia        @relation(fields: [pulperiaId], references: [id], onDelete: Cascade)
}

// Promociones y Descuentos
model Promotion {
  id                  String          @id @default(cuid())
  pulperiaId          String
  name                String
  description         String?
  type                PromotionType
  value               Float                                 // Porcentaje o monto fijo
  minPurchase         Float?                                // Compra minima
  maxDiscount         Float?                                // Descuento maximo
  productIds          String[]                              // IDs de productos aplicables
  categoryIds         String[]                              // Categorias aplicables
  startDate           DateTime
  endDate             DateTime?
  isActive            Boolean         @default(true)
  usageCount          Int             @default(0)
  maxUsage            Int?                                  // Limite de usos

  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  pulperia            Pulperia        @relation(fields: [pulperiaId], references: [id], onDelete: Cascade)

  @@index([pulperiaId])
  @@index([isActive, startDate, endDate])
}

// Servicios de Pulperias (delivery, recargas, pagos, etc.)
model PulperiaService {
  id                  String          @id @default(cuid())
  pulperiaId          String
  name                String
  description         String?
  price               Float?
  priceMax            Float?                                // Para precios variables
  priceType           PriceType       @default(FIXED)
  duration            String?                               // "30-45 min", "Inmediato"
  imageUrl            String?
  imagePublicId       String?
  isAvailable         Boolean         @default(true)

  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  pulperia            Pulperia        @relation(fields: [pulperiaId], references: [id], onDelete: Cascade)

  @@index([pulperiaId])
  @@index([isAvailable])
}

// ═══════════════════════════════════════════════════════════════
// SISTEMA UNIFICADO: CHAMBA
// (Término hondureño para trabajo/servicio)
// ═══════════════════════════════════════════════════════════════

enum ChambaType {
  EMPLOYMENT    // "Busco empleado" (era Job)
  SERVICE       // "Ofrezco servicio" (era PulperiaService + ServiceCatalog)
  REQUEST       // "Necesito servicio" (NUEVO - conecta demanda)
}

enum ChambaCategory {
  // Técnicos/Reparaciones
  MECANICA
  PLOMERIA
  ELECTRICIDAD
  CARPINTERIA
  CELULARES
  ELECTRODOMESTICOS

  // Belleza/Cuidado
  BARBERIA
  SALON_BELLEZA
  MASAJES

  // Hogar
  LIMPIEZA
  JARDINERIA
  PINTURA
  MUDANZAS

  // Comida
  COCINA
  REPOSTERIA
  CATERING

  // Comercio
  VENTAS
  ATENCION_CLIENTE

  // Otros
  TRANSPORTE
  DELIVERY
  TUTORIA
  FOTOGRAFIA
  OTRO
}

model Chamba {
  id              String          @id @default(cuid())

  // Quien publica
  pulperiaId      String?         // Opcional - si es negocio
  userId          String          // Siempre requerido

  // Tipo y categoría
  type            ChambaType
  category        ChambaCategory

  // Información básica
  title           String
  description     String?

  // Precio (flexible para todos los casos)
  priceType       PriceType       @default(NEGOTIABLE)
  priceMin        Float?
  priceMax        Float?

  // Para EMPLOYMENT
  isPartTime      Boolean         @default(false)
  isUrgent        Boolean         @default(false)
  requirements    String?
  salary          String?

  // Para SERVICE
  duration        String?
  serviceArea     String?

  // Media (portafolio)
  images          String[]
  imagePublicIds  String[]

  // Ubicación
  latitude        Float?
  longitude       Float?

  // Contacto
  contactPhone    String?
  contactWhatsapp String?

  // Estado
  isActive        Boolean         @default(true)
  expiresAt       DateTime?
  viewCount       Int             @default(0)

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  pulperia        Pulperia?       @relation(fields: [pulperiaId], references: [id], onDelete: Cascade)
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  responses       ChambaResponse[]
  appointments    Appointment[]

  @@index([type, category, isActive])
  @@index([pulperiaId])
  @@index([userId])
}

enum ChambaResponseStatus {
  PENDING
  ACCEPTED
  REJECTED
  COMPLETED
}

model ChambaResponse {
  id              String                @id @default(cuid())
  chambaId        String
  userId          String

  message         String?
  proposedPrice   Float?                // Para cotizaciones
  estimatedTime   String?
  cvUrl           String?               // Para empleos
  cvPublicId      String?

  status          ChambaResponseStatus  @default(PENDING)
  responseNote    String?

  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt

  chamba          Chamba                @relation(fields: [chambaId], references: [id], onDelete: Cascade)
  user            User                  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([chambaId, userId])
  @@index([chambaId])
  @@index([userId])
}

// ═══════════════════════════════════════════════════════════════
// AGENDA DE CITAS
// ═══════════════════════════════════════════════════════════════

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
}

model Appointment {
  id              String            @id @default(cuid())
  chambaId        String?           // Ligada a chamba de servicio
  pulperiaId      String?           // O directamente a pulpería

  clientId        String
  clientName      String
  clientPhone     String?

  serviceName     String
  date            DateTime
  timeSlot        String            // "09:00"
  duration        Int               @default(60)
  agreedPrice     Float?

  status          AppointmentStatus @default(SCHEDULED)
  notes           String?

  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  chamba          Chamba?           @relation(fields: [chambaId], references: [id], onDelete: SetNull)
  pulperia        Pulperia?         @relation(fields: [pulperiaId], references: [id], onDelete: Cascade)
  client          User              @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([pulperiaId, date])
  @@index([clientId])
  @@index([chambaId])
}

// ═══════════════════════════════════════════════════════════════
// COTIZACIONES (Técnicos/Artesanos)
// ═══════════════════════════════════════════════════════════════

enum QuoteStatus {
  DRAFT
  SENT
  ACCEPTED
  REJECTED
  EXPIRED
  COMPLETED
}

model Quote {
  id              String        @id @default(cuid())
  quoteNumber     String        @unique

  pulperiaId      String?
  userId          String

  clientName      String
  clientPhone     String?
  clientWhatsapp  String?

  title           String
  description     String?

  items           Json          // [{name, qty, unitPrice, total}]
  laborCost       Float         @default(0)
  materialsCost   Float         @default(0)
  subtotal        Float
  discount        Float         @default(0)
  total           Float

  validUntil      DateTime?
  estimatedTime   String?
  warranty        String?
  paymentTerms    String?
  notes           String?

  status          QuoteStatus   @default(DRAFT)
  sentAt          DateTime?
  acceptedAt      DateTime?
  completedAt     DateTime?

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  pulperia        Pulperia?     @relation(fields: [pulperiaId], references: [id], onDelete: Cascade)
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([pulperiaId])
  @@index([userId])
  @@index([status])
}

// ═══════════════════════════════════════════════════════════════
// CONTROL DE GASTOS
// ═══════════════════════════════════════════════════════════════

enum ExpenseCategory {
  SUPPLIES      // Insumos
  TRANSPORT     // Transporte
  FOOD          // Comida
  UTILITIES     // Servicios
  RENT          // Alquiler
  SALARIES      // Sueldos
  MAINTENANCE   // Mantenimiento
  MARKETING     // Publicidad
  OTHER         // Otros
}

model Expense {
  id              String          @id @default(cuid())
  pulperiaId      String

  amount          Float
  category        ExpenseCategory
  description     String?
  receiptUrl      String?
  receiptPublicId String?

  date            DateTime        @default(now())
  createdAt       DateTime        @default(now())

  pulperia        Pulperia        @relation(fields: [pulperiaId], references: [id], onDelete: Cascade)

  @@index([pulperiaId, date])
}

// ═══════════════════════════════════════════════════════════════
// TIPOS DE NEGOCIO (Onboarding Adaptativo)
// ═══════════════════════════════════════════════════════════════

enum BusinessType {
  TIENDA        // Pulpería tradicional
  AMBULANTE     // Vendedor móvil
  SERVICIOS     // Barbería, salón
  TALLER        // Mecánico, técnico
  COMIDA        // Producción casera
  FREELANCE     // Sin local físico
  OTRO
}

// ═══════════════════════════════════════════════════════════════
// TIPOS DE PRODUCTO (Inventario Híbrido)
// ═══════════════════════════════════════════════════════════════

enum ProductType {
  PHYSICAL      // Producto con stock (actual)
  SERVICE       // Servicio por hora/unidad
  BULK          // Producto fraccionable
}

// ═══════════════════════════════════════════════════════════════
// ANUNCIOS (Sistema de Ofertas Locales)
// ═══════════════════════════════════════════════════════════════

model Announcement {
  id                String    @id @default(cuid())
  pulperiaId        String

  // Contenido
  title             String    @db.VarChar(60)
  description       String?   @db.VarChar(200)
  price             Float?
  imageUrl          String
  imagePublicId     String
  imageAspectRatio  Float     @default(1.0)  // width/height para Masonry grid

  // Estado
  isActive          Boolean   @default(true)
  isFeatured        Boolean   @default(false)  // Futuro: pagado/destacado

  // Expiración
  expiresAt         DateTime  // Default: now + 7 días

  // Métricas
  viewCount         Int       @default(0)
  contactCount      Int       @default(0)  // Clicks en WhatsApp

  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  pulperia          Pulperia  @relation(fields: [pulperiaId], references: [id], onDelete: Cascade)

  @@index([pulperiaId])
  @@index([isActive, expiresAt])
}

